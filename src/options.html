<html>
	<head>
		<script src="set_background_context.js"></script>
		<script src="Options.js"></script>
		<script>
			var leaveOnTopicAllReadCheckbox;
			var leaveOnIgnoreCheckbox;
			var exportImportTable;
			var exportImportField;
			
			
			function loaded() {
				leaveOnTopicAllReadCheckbox = document.getElementById("leave_on_topic_allRead");
				leaveOnIgnoreCheckbox       = document.getElementById("leave_on_ignore");
				
				exportImportTable = document.getElementById("export_import_table");
				exportImportField = document.getElementById("export_import_data");
				
				document.title = chrome.i18n.getMessage("extension_name");
				
				document.getElementById("leave_on_topic_allRead_label").textContent = chrome.i18n.getMessage("options_label_leave_on_topic_allRead");
				document.getElementById("leave_on_ignore_label").textContent        = chrome.i18n.getMessage("options_label_leave_on_ignore");
				
				document.getElementById("export_import").textContent                = chrome.i18n.getMessage("options_label_Export_Import");
				document.getElementById("export_import_instructions").innerHTML     = chrome.i18n.getMessage("options_text_export_import_instructions");
				document.getElementById("import_button").textContent                = chrome.i18n.getMessage("options_button_Import");
				
				
				Options.get(function(options) {
					leaveOnTopicAllReadCheckbox.checked = options.leaveOnTopicAllRead;
					leaveOnIgnoreCheckbox.checked       = options.leaveOnIgnore;
				});
			}
			
			
			function toggleLeaveOnTopicAllRead() {
				Options.get(function(options) {
					options.leaveOnTopicAllRead = leaveOnTopicAllReadCheckbox.checked;
					Options.set(options);
				});
			}
			
			
			function toggleLeaveOnIgnore() {
				Options.get(function(options) {
					options.leaveOnIgnore = leaveOnIgnoreCheckbox.checked;
					Options.set(options);
				});
			}
			
			
			function toggleExportImport() {
				if(exportImportTable.style.display == 'none') {
					// Show
					var str = '';
					for(key in localStorage) {
						if(key != "USER_OPTIONS") {
							str += key + ' ' + localStorage[key] + '\n';
						}
					}
					exportImportField.value = str;
					
					exportImportTable.style.display = '';
				} else {
					// Hide
					exportImportTable.style.display = 'none';
				}
			}
			
			
			function importData() {
				var userOptions = localStorage['USER_OPTIONS'];
				localStorage.clear();
				localStorage['USER_OPTIONS'] = userOptions;
				
				var str = exportImportField.value;
				var values = str.split('\n');
				for(var i = 0; i < values.length; i++) {
					var value = values[i];
					var parts = value.split(' ');
					var key = parts[0];
					var val = parts[1];
					localStorage[key] = val;
				}
				
				alert(chrome.i18n.getMessage("options_alert_import_done"));
			}
		</script>
	</head>
	<body onload="loaded();">
		<input type="checkbox" id="leave_on_topic_allRead" onclick="toggleLeaveOnTopicAllRead();"/>
		<label for="leave_on_topic_allRead" id="leave_on_topic_allRead_label"></label>
		<br/>
		
		<input type="checkbox" id="leave_on_ignore" onclick="toggleLeaveOnIgnore();"/>
		<label for="leave_on_ignore" id="leave_on_ignore_label"></label>
		<br/>
		
		<hr/>
		<div style="text-align: right;">
			<a id="export_import" href="javascript:void(0);" onclick="toggleExportImport();"></a>
		</div>
		<table id="export_import_table" style="display:none;">
			<tr>
				<td id="export_import_instructions"></td>
				<td width="60%">
					<textarea id="export_import_data" style="width:100%;height:200px"></textarea>
					<button id="import_button" onclick="importData()">XXX</button>
				</td>
			</tr>
		</table>
	</body>
</html>
